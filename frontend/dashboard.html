<!DOCTYPE html>
<html>
<head>
    <title>Parking Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

<div class="card dashboard">
    <h2>Parking Management</h2>

    <h3>Vehicle Entry</h3>
    <input id="vehicle_number" placeholder="Vehicle Number">
<input type="email" id="email" placeholder="Enter user email" required />

    <input id="mobile_number" placeholder="Owner Mobile Number">
    <select id="type">
        <option value="car">Car</option>
        <option value="bike">Bike</option>
    </select>

    <button onclick="vehicleEntry()">Add Entry</button>

    <hr style="margin:20px 0;border:1px solid #fff">
<div class="vehicalexit">
    <h2>Vehicle Exit</h2>
    <input id="token" placeholder="Enter Token Number">
    <button onclick="vehicleExit()">Exit</button>
</div>


<div id="paymentSection" style="margin-top:20px;"></div>

<script>
    async function vehicleEntry() {
    let data = {
        vehicle_number: vehicle_number.value,
        email: email.value,  
        type: type.value,
        mobile_number: mobile_number.value,
    };

    let res = await fetch("http://localhost:5000/parking/entry", {
        method: 'POST',
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(data)
    });

    let json = await res.json();

    alert("Token Generated: " + json.token);
}


// Step 1: Calculate Exit Charges
async function vehicleExit() {
    let tokenVal = token.value;

    let res = await fetch("http://localhost:5000/parking/exit", {
        method:'POST',
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ token: tokenVal })
    });

    let data = await res.json();
    if (data.message === "Invalid Token") {
        alert("Invalid Token!");
        return;
    }

    // Show Payment Options
    paymentSection.innerHTML = `
        <h3>Total Hours: ${data.hours}</h3>
        <h3>Total Charge: â‚¹${data.charges}</h3>
        <h4>Select Payment Method:</h4>
        <button onclick="payOnline('${data.token}')">Online</button>
        <button onclick="payCash('${data.token}')">Cash</button>
        <div id="onlineQR" style="margin-top:20px;"></div>
    `;
}

// Step 2: Online Payment
function payOnline(token) {
    document.getElementById("onlineQR").innerHTML = `
        <h4>Scan QR Code to Pay</h4>
        <img 
            src="https://github.com/P170-Rp/Parking-Management-System/blob/main/WhatsApp%20Image%202025-12-26%20at%2011.47.20%20AM.jpeg"
            alt="QR Code"
            width="150"
            height="150"
        >
        <p>Token: <strong>${token}</strong></p>
        <button onclick="completePayment('${token}', 'online')">
            Done
        </button>
    `;
}

// Step 3: Cash Payment
function payCash(token) {
    if(confirm("Confirm Cash Payment?")) {
        completePayment(token, 'cash');
    }
}

// Step 4: Complete Payment API Call
async function completePayment(token, method) {
    let res = await fetch("http://localhost:5000/parking/complete-payment", {
        method: 'POST',
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ token, method })
    });

    let data = await res.json();
    alert(data.message);

    // Reset dashboard
    paymentSection.innerHTML = "";
    token.value = "";
}
</script>


</body>
</html>
